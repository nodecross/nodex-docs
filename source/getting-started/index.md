# Getting Started

Try an example of sending a message via a NodeX Agent and receiving it.

## Set up NodeX Agent

Perform the necessary setup before starting the NodeX Agent.

It is assumed that NodeX Agent is already installed.

If you have not already installed NodeX Agent, please follow the [Installation](../installation/index.md) chapter to complete the installation of NodeX Agent.

### DID generation and network configuration

In the commands below, generate a DID for the device.

```sh
$ nodex-agent --config did
```

Once the DID is generated, a file `~/.config/nodex/config.json` is generated.
You can check the generated DID by executing the following command.

```sh
$ cat ~/.config/nodex/config.json | grep did
```

In the commands below, use the project secret key and project DID provided by CollaboGate Japan, Inc.

```sh
$ nodex-agent --config network set --key secret_key --value <YOUR PROJECT SECRET KEY>
$ nodex-agent --config network set --key project_did --value <YOUR PROJECT DID>
```

After the command is executed, secret_key and project_did are set in `~/.config/nodex/network.json`.

```{note}
Do not modify the config.json and network.json generated by executing the above commands.
```

The setup is now complete.
You can start nodex-agent by executing the following command.

```sh
$ nodex-agent
```

```{note}
After configuring the agent, it typically takes approximately 30 minutes for the registration to be completed in the decentralized anchoring system. 
During this time, messages can't be sent and received. Kindly wait for a while and then spin up the agent.
```

## How to Create Encrypted Message in NodeX

This section shows how to create encrypted messages using the NodeX Agent.

### Requirements

- Please set up NodeX Agent before the below action.
- This section uses Python. So, please install it.

1. Run the example of creating a Verifiable Message. The original code is **[here](https://github.com/nodecross/nodex/blob/main/examples/python/v2/cli)**.

The following is part of the example code.

```Python
from sock import post
import json
import pprint


# PLEASE WRITE destination_did, message, AND operation_tag.
destination_did = (
    "did:nodex:test:DummyDummyDummyDummyDummyDummyDummyDummyDummyD"
)
message = {
    "message": {
        "string": "value",
        "number": 1,
        "boolean": True,
        "array": ["foo", "bar", "baz"],
        "map": {"key": "value"},
    }
}
operation_tag = "test-operation-tag"


payload = {
    "destination_did": destination_did,
    "message": json.dumps(message),
    "operation_tag": operation_tag,
}

json_response = post("/create-verifiable-message", payload)

print("The response is as follows.\n")
print(json_response)

print('\nPlease paste below to "verify_vc_message.py".\n')
pprint.pprint(json.loads(json_response), sort_dicts=False)
```

Execute the following commands.

```shell
$ cd /path/to/python/v2/cli/
$ python generate_vc_message.py
```

2. Check the Response. In the example implementation, the response can be viewed on standard output.


## How to Verify Encrypted Message in NodeX

This section shows how to verify encrypted messages using the NodeX Agent.

### Requirements

- Please set up NodeX Agent before the below action.
- This section uses Python. So, please install it.

1. Run the example of verifying a Message. The original code is **[here](https://github.com/nodecross/nodex/blob/main/examples/python/v2/cli)**.

The following is part of the example code.

```Python
from sock import post
import json


# PLEASE PASTE BELOW THE RESPONSE FROM "generate_vc_message.py".
message = {
    "issuer": {
        "id": "did:nodex:test:DummyDummyDummyDummyDummyDummyDummyDummyDummyD"
    },
    "issuanceDate": "2024-03-22T11:43:47.741035+00:00",
    "@context": ["https://www.w3.org/2018/credentials/v1"],
    "type": ["VerifiableCredential"],
    "credentialSubject": {
        "container": {
            "created_at": "2024-03-22T11:43:47.741035+00:00",
            "destination_did": "did:nodex:test:DummyDummyDummyDummyDummyDummyDummyDummyDummyD",
            "message_id": "d8b8bfbc-88ed-4d93-bfa5-a634e35d104e",
            "payload": '{"message": {"string": '
            '"value", "number": 1, '
            '"boolean": true, "array": '
            '["foo", "bar", "baz"], "map": '
            '{"key": "value"}}}',
            "project_hmac": "fc67f9f5c17ccd44ff3f8e270870c2b04f0980e22766b619a62f7c7ac4c95058",
        }
    },
    "proof": {
        "type": "EcdsaSecp256k1Signature2019",
        "proofPurpose": "authentication",
        "created": "2024-03-22T11:43:47.775189+00:00",
        "verificationMethod": "did:nodex:test:DummyDummyDummyDummyDummyDummyDummyDummyDummyD#signingKey",
        "jws": "eyJhbGciOiJFUzI1NksiLCJiNjQiOmZhbHNlLCJjcml0IjpbImI2NCJdfQ..AnO3rmljCEHhbxvvLKxml8coj-JOwSSczlCxS7zfVBRy11AABM-aFBvwJKP32-VMESZnfF_EH0PZvkJSCAnqOg",
        "controller": None,
        "challenge": None,
        "domain": None,
    },
}


payload = {
    "message": json.dumps(message),
}

json_response = post("/verify-verifiable-message", payload)

print("The response is as follows.\n")
print(json_response)
```

Execute the following commands.

```shell
$ cd /path/to/python/v2/cli/
$ python verify_vc_message.py
```

2. Check the Response. In the example implementation, the response can be viewed on standard output.
